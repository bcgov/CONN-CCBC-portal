BEGIN;

-- Disable triggers to prevent interference during updates
ALTER TABLE ccbc_public.record_version DISABLE TRIGGER ALL;

-- Main update query for record_version where table_name = 'sow_tab_7'
UPDATE ccbc_public.record_version
SET
  record = CASE
    WHEN record IS NOT NULL AND record ? 'json_data' THEN
      jsonb_set(
        record,
        '{json_data}',
        ccbc_public.anonymize_sow_tab_7_numeric_fields(
          record->'json_data',
          (record->>'id')::integer,
          ARRAY[
            'summaryTable,totalProjectCost',
            'summaryTable,totalEligibleCosts',
            'summaryTable,totalIneligibleCosts',
            'summaryTable,totalFundingRequestedCCBC',
            'summaryTable,fundingFromAllOtherSources',
            'summaryTable,totalApplicantContribution',
            'summaryTable,amountRequestedFromProvince',
            'summaryTable,totalInfrastructureBankFunding',
            'summaryTable,amountRequestedFromFederalGovernment',
            'detailedBudget,federalSharingRatio',
            'detailedBudget,provincialSharingRatio',
            'summaryOfEstimatedProjectCosts,projectCosts,totalProjectCost,2324',
            'summaryOfEstimatedProjectCosts,projectCosts,totalProjectCost,2425',
            'summaryOfEstimatedProjectCosts,projectCosts,totalProjectCost,2526',
            'summaryOfEstimatedProjectCosts,projectCosts,totalProjectCost,2627',
            'summaryOfEstimatedProjectCosts,projectCosts,totalProjectCost,total',
            'summaryOfEstimatedProjectCosts,projectCosts,totalEligibleCosts,2324',
            'summaryOfEstimatedProjectCosts,projectCosts,totalEligibleCosts,2425',
            'summaryOfEstimatedProjectCosts,projectCosts,totalEligibleCosts,2526',
            'summaryOfEstimatedProjectCosts,projectCosts,totalEligibleCosts,2627',
            'summaryOfEstimatedProjectCosts,projectCosts,totalEligibleCosts,total',
            'summaryOfEstimatedProjectCosts,projectCosts,totalIneligibleCosts,2324',
            'summaryOfEstimatedProjectCosts,projectCosts,totalIneligibleCosts,2425',
            'summaryOfEstimatedProjectCosts,projectCosts,totalIneligibleCosts,2526',
            'summaryOfEstimatedProjectCosts,projectCosts,totalIneligibleCosts,2627',
            'summaryOfEstimatedProjectCosts,projectCosts,totalIneligibleCosts,total',
            'summaryOfEstimatedProjectCosts,estimatedProjectCosts,eligibleMobile',
            'summaryOfEstimatedProjectCosts,estimatedProjectCosts,totalProjectCost',
            'summaryOfEstimatedProjectCosts,estimatedProjectCosts,totalEligibleCosts',
            'summaryOfEstimatedProjectCosts,estimatedProjectCosts,totalIneligibleCosts',
            'summaryOfEstimatedProjectCosts,estimatedProjectCosts,eligibleRuralBroadband',
            'summaryOfEstimatedProjectCosts,estimatedProjectCosts,eligibleVeryRemoteSatelliteIndigenousBroadband',
            'summaryOfEstimatedProjectCosts,totalCostsPerCostCategory,directOther,cost',
            'summaryOfEstimatedProjectCosts,totalCostsPerCostCategory,directOther,percentOfTotalEligibleCosts',
            'summaryOfEstimatedProjectCosts,totalCostsPerCostCategory,directLabour,cost',
            'summaryOfEstimatedProjectCosts,totalCostsPerCostCategory,directLabour,percentOfTotalEligibleCosts',
            'summaryOfEstimatedProjectCosts,totalCostsPerCostCategory,directTravel,cost',
            'summaryOfEstimatedProjectCosts,totalCostsPerCostCategory,directTravel,percentOfTotalEligibleCosts',
            'summaryOfEstimatedProjectCosts,totalCostsPerCostCategory,totalEligible,cost',
            'summaryOfEstimatedProjectCosts,totalCostsPerCostCategory,totalEligible,percentOfTotalEligibleCosts',
            'summaryOfEstimatedProjectCosts,totalCostsPerCostCategory,directEquipment,cost',
            'summaryOfEstimatedProjectCosts,totalCostsPerCostCategory,directEquipment,percentOfTotalEligibleCosts',
            'summaryOfEstimatedProjectCosts,totalCostsPerCostCategory,directMaterials,cost',
            'summaryOfEstimatedProjectCosts,totalCostsPerCostCategory,directMaterials,percentOfTotalEligibleCosts',
            'summaryOfEstimatedProjectCosts,totalCostsPerCostCategory,directSatellite,cost',
            'summaryOfEstimatedProjectCosts,totalCostsPerCostCategory,directSatellite,percentOfTotalEligibleCosts',
            'summaryOfEstimatedProjectCosts,thirtyPercentOfTotalEligibleCosts',
            'summaryOfEstimatedProjectFunding,federalContribution,2324',
            'summaryOfEstimatedProjectFunding,federalContribution,2425',
            'summaryOfEstimatedProjectFunding,federalContribution,2526',
            'summaryOfEstimatedProjectFunding,federalContribution,2627',
            'summaryOfEstimatedProjectFunding,federalContribution,total',
            'summaryOfEstimatedProjectFunding,otherFundingPartners,2324',
            'summaryOfEstimatedProjectFunding,otherFundingPartners,2425',
            'summaryOfEstimatedProjectFunding,otherFundingPartners,2526',
            'summaryOfEstimatedProjectFunding,otherFundingPartners,2627',
            'summaryOfEstimatedProjectFunding,otherFundingPartners,total',
            'summaryOfEstimatedProjectFunding,provincialContribution,2324',
            'summaryOfEstimatedProjectFunding,provincialContribution,2425',
            'summaryOfEstimatedProjectFunding,provincialContribution,2526',
            'summaryOfEstimatedProjectFunding,provincialContribution,2627',
            'summaryOfEstimatedProjectFunding,provincialContribution,total',
            'summaryOfEstimatedProjectFunding,applicationContribution,2324',
            'summaryOfEstimatedProjectFunding,applicationContribution,2425',
            'summaryOfEstimatedProjectFunding,applicationContribution,2526',
            'summaryOfEstimatedProjectFunding,applicationContribution,2627',
            'summaryOfEstimatedProjectFunding,applicationContribution,total',
            'summaryOfEstimatedProjectFunding,infrastructureBankFunding,2324',
            'summaryOfEstimatedProjectFunding,infrastructureBankFunding,2425',
            'summaryOfEstimatedProjectFunding,infrastructureBankFunding,2526',
            'summaryOfEstimatedProjectFunding,infrastructureBankFunding,2627',
            'summaryOfEstimatedProjectFunding,infrastructureBankFunding,total',
            'summaryOfEstimatedProjectFunding,totalFinancialContribution,2324',
            'summaryOfEstimatedProjectFunding,totalFinancialContribution,2425',
            'summaryOfEstimatedProjectFunding,totalFinancialContribution,2526',
            'summaryOfEstimatedProjectFunding,totalFinancialContribution,2627',
            'summaryOfEstimatedProjectFunding,totalFinancialContribution,total',
            'currentFiscalProvincialContributionForecastByQuarter,aprilToJune,2324',
            'currentFiscalProvincialContributionForecastByQuarter,aprilToJune,2425',
            'currentFiscalProvincialContributionForecastByQuarter,aprilToJune,2526',
            'currentFiscalProvincialContributionForecastByQuarter,aprilToJune,2627',
            'currentFiscalProvincialContributionForecastByQuarter,aprilToJune,total',
            'currentFiscalProvincialContributionForecastByQuarter,januaryToMarch,2324',
            'currentFiscalProvincialContributionForecastByQuarter,januaryToMarch,2425',
            'currentFiscalProvincialContributionForecastByQuarter,januaryToMarch,2526',
            'currentFiscalProvincialContributionForecastByQuarter,januaryToMarch,2627',
            'currentFiscalProvincialContributionForecastByQuarter,januaryToMarch,total',
            'currentFiscalProvincialContributionForecastByQuarter,fiscalYearTotal,2324',
            'currentFiscalProvincialContributionForecastByQuarter,fiscalYearTotal,2425',
            'currentFiscalProvincialContributionForecastByQuarter,fiscalYearTotal,2526',
            'currentFiscalProvincialContributionForecastByQuarter,fiscalYearTotal,2627',
            'currentFiscalProvincialContributionForecastByQuarter,fiscalYearTotal,total',
            'currentFiscalProvincialContributionForecastByQuarter,julyToSeptember,2324',
            'currentFiscalProvincialContributionForecastByQuarter,julyToSeptember,2425',
            'currentFiscalProvincialContributionForecastByQuarter,julyToSeptember,2526',
            'currentFiscalProvincialContributionForecastByQuarter,julyToSeptember,2627',
            'currentFiscalProvincialContributionForecastByQuarter,julyToSeptember,total',
            'currentFiscalProvincialContributionForecastByQuarter,octoberToDecember,2324',
            'currentFiscalProvincialContributionForecastByQuarter,octoberToDecember,2425',
            'currentFiscalProvincialContributionForecastByQuarter,octoberToDecember,2526',
            'currentFiscalProvincialContributionForecastByQuarter,octoberToDecember,2627',
            'currentFiscalProvincialContributionForecastByQuarter,octoberToDecember,total'
          ]::text[]
        )
      )
    ELSE record
  END,
  old_record = CASE
    WHEN old_record IS NOT NULL AND old_record ? 'json_data' THEN
      jsonb_set(
        old_record,
        '{json_data}',
        ccbc_public.anonymize_sow_tab_7_numeric_fields(
          old_record->'json_data',
          (old_record->>'id')::integer,
          ARRAY[
            'summaryTable,totalProjectCost',
            'summaryTable,totalEligibleCosts',
            'summaryTable,totalIneligibleCosts',
            'summaryTable,totalFundingRequestedCCBC',
            'summaryTable,fundingFromAllOtherSources',
            'summaryTable,totalApplicantContribution',
            'summaryTable,amountRequestedFromProvince',
            'summaryTable,totalInfrastructureBankFunding',
            'summaryTable,amountRequestedFromFederalGovernment',
            'detailedBudget,federalSharingRatio',
            'detailedBudget,provincialSharingRatio',
            'summaryOfEstimatedProjectCosts,projectCosts,totalProjectCost,2324',
            'summaryOfEstimatedProjectCosts,projectCosts,totalProjectCost,2425',
            'summaryOfEstimatedProjectCosts,projectCosts,totalProjectCost,2526',
            'summaryOfEstimatedProjectCosts,projectCosts,totalProjectCost,2627',
            'summaryOfEstimatedProjectCosts,projectCosts,totalProjectCost,total',
            'summaryOfEstimatedProjectCosts,projectCosts,totalEligibleCosts,2324',
            'summaryOfEstimatedProjectCosts,projectCosts,totalEligibleCosts,2425',
            'summaryOfEstimatedProjectCosts,projectCosts,totalEligibleCosts,2526',
            'summaryOfEstimatedProjectCosts,projectCosts,totalEligibleCosts,2627',
            'summaryOfEstimatedProjectCosts,projectCosts,totalEligibleCosts,total',
            'summaryOfEstimatedProjectCosts,projectCosts,totalIneligibleCosts,2324',
            'summaryOfEstimatedProjectCosts,projectCosts,totalIneligibleCosts,2425',
            'summaryOfEstimatedProjectCosts,projectCosts,totalIneligibleCosts,2526',
            'summaryOfEstimatedProjectCosts,projectCosts,totalIneligibleCosts,2627',
            'summaryOfEstimatedProjectCosts,projectCosts,totalIneligibleCosts,total',
            'summaryOfEstimatedProjectCosts,estimatedProjectCosts,eligibleMobile',
            'summaryOfEstimatedProjectCosts,estimatedProjectCosts,totalProjectCost',
            'summaryOfEstimatedProjectCosts,estimatedProjectCosts,totalEligibleCosts',
            'summaryOfEstimatedProjectCosts,estimatedProjectCosts,totalIneligibleCosts',
            'summaryOfEstimatedProjectCosts,estimatedProjectCosts,eligibleRuralBroadband',
            'summaryOfEstimatedProjectCosts,estimatedProjectCosts,eligibleVeryRemoteSatelliteIndigenousBroadband',
            'summaryOfEstimatedProjectCosts,totalCostsPerCostCategory,directOther,cost',
            'summaryOfEstimatedProjectCosts,totalCostsPerCostCategory,directOther,percentOfTotalEligibleCosts',
            'summaryOfEstimatedProjectCosts,totalCostsPerCostCategory,directLabour,cost',
            'summaryOfEstimatedProjectCosts,totalCostsPerCostCategory,directLabour,percentOfTotalEligibleCosts',
            'summaryOfEstimatedProjectCosts,totalCostsPerCostCategory,directTravel,cost',
            'summaryOfEstimatedProjectCosts,totalCostsPerCostCategory,directTravel,percentOfTotalEligibleCosts',
            'summaryOfEstimatedProjectCosts,totalCostsPerCostCategory,totalEligible,cost',
            'summaryOfEstimatedProjectCosts,totalCostsPerCostCategory,totalEligible,percentOfTotalEligibleCosts',
            'summaryOfEstimatedProjectCosts,totalCostsPerCostCategory,directEquipment,cost',
            'summaryOfEstimatedProjectCosts,totalCostsPerCostCategory,directEquipment,percentOfTotalEligibleCosts',
            'summaryOfEstimatedProjectCosts,totalCostsPerCostCategory,directMaterials,cost',
            'summaryOfEstimatedProjectCosts,totalCostsPerCostCategory,directMaterials,percentOfTotalEligibleCosts',
            'summaryOfEstimatedProjectCosts,totalCostsPerCostCategory,directSatellite,cost',
            'summaryOfEstimatedProjectCosts,totalCostsPerCostCategory,directSatellite,percentOfTotalEligibleCosts',
            'summaryOfEstimatedProjectCosts,thirtyPercentOfTotalEligibleCosts',
            'summaryOfEstimatedProjectFunding,federalContribution,2324',
            'summaryOfEstimatedProjectFunding,federalContribution,2425',
            'summaryOfEstimatedProjectFunding,federalContribution,2526',
            'summaryOfEstimatedProjectFunding,federalContribution,2627',
            'summaryOfEstimatedProjectFunding,federalContribution,total',
            'summaryOfEstimatedProjectFunding,otherFundingPartners,2324',
            'summaryOfEstimatedProjectFunding,otherFundingPartners,2425',
            'summaryOfEstimatedProjectFunding,otherFundingPartners,2526',
            'summaryOfEstimatedProjectFunding,otherFundingPartners,2627',
            'summaryOfEstimatedProjectFunding,otherFundingPartners,total',
            'summaryOfEstimatedProjectFunding,provincialContribution,2324',
            'summaryOfEstimatedProjectFunding,provincialContribution,2425',
            'summaryOfEstimatedProjectFunding,provincialContribution,2526',
            'summaryOfEstimatedProjectFunding,provincialContribution,2627',
            'summaryOfEstimatedProjectFunding,provincialContribution,total',
            'summaryOfEstimatedProjectFunding,applicationContribution,2324',
            'summaryOfEstimatedProjectFunding,applicationContribution,2425',
            'summaryOfEstimatedProjectFunding,applicationContribution,2526',
            'summaryOfEstimatedProjectFunding,applicationContribution,2627',
            'summaryOfEstimatedProjectFunding,applicationContribution,total',
            'summaryOfEstimatedProjectFunding,infrastructureBankFunding,2324',
            'summaryOfEstimatedProjectFunding,infrastructureBankFunding,2425',
            'summaryOfEstimatedProjectFunding,infrastructureBankFunding,2526',
            'summaryOfEstimatedProjectFunding,infrastructureBankFunding,2627',
            'summaryOfEstimatedProjectFunding,infrastructureBankFunding,total',
            'summaryOfEstimatedProjectFunding,totalFinancialContribution,2324',
            'summaryOfEstimatedProjectFunding,totalFinancialContribution,2425',
            'summaryOfEstimatedProjectFunding,totalFinancialContribution,2526',
            'summaryOfEstimatedProjectFunding,totalFinancialContribution,2627',
            'summaryOfEstimatedProjectFunding,totalFinancialContribution,total',
            'currentFiscalProvincialContributionForecastByQuarter,aprilToJune,2324',
            'currentFiscalProvincialContributionForecastByQuarter,aprilToJune,2425',
            'currentFiscalProvincialContributionForecastByQuarter,aprilToJune,2526',
            'currentFiscalProvincialContributionForecastByQuarter,aprilToJune,2627',
            'currentFiscalProvincialContributionForecastByQuarter,aprilToJune,total',
            'currentFiscalProvincialContributionForecastByQuarter,januaryToMarch,2324',
            'currentFiscalProvincialContributionForecastByQuarter,januaryToMarch,2425',
            'currentFiscalProvincialContributionForecastByQuarter,januaryToMarch,2526',
            'currentFiscalProvincialContributionForecastByQuarter,januaryToMarch,2627',
            'currentFiscalProvincialContributionForecastByQuarter,januaryToMarch,total',
            'currentFiscalProvincialContributionForecastByQuarter,fiscalYearTotal,2324',
            'currentFiscalProvincialContributionForecastByQuarter,fiscalYearTotal,2425',
            'currentFiscalProvincialContributionForecastByQuarter,fiscalYearTotal,2526',
            'currentFiscalProvincialContributionForecastByQuarter,fiscalYearTotal,2627',
            'currentFiscalProvincialContributionForecastByQuarter,fiscalYearTotal,total',
            'currentFiscalProvincialContributionForecastByQuarter,julyToSeptember,2324',
            'currentFiscalProvincialContributionForecastByQuarter,julyToSeptember,2425',
            'currentFiscalProvincialContributionForecastByQuarter,julyToSeptember,2526',
            'currentFiscalProvincialContributionForecastByQuarter,julyToSeptember,2627',
            'currentFiscalProvincialContributionForecastByQuarter,julyToSeptember,total',
            'currentFiscalProvincialContributionForecastByQuarter,octoberToDecember,2324',
            'currentFiscalProvincialContributionForecastByQuarter,octoberToDecember,2425',
            'currentFiscalProvincialContributionForecastByQuarter,octoberToDecember,2526',
            'currentFiscalProvincialContributionForecastByQuarter,octoberToDecember,2627',
            'currentFiscalProvincialContributionForecastByQuarter,octoberToDecember,total'
          ]::text[]
        )
      )
    ELSE old_record
  END
WHERE table_name = 'sow_tab_7' AND (
  (record IS NOT NULL AND record ? 'json_data') OR
  (old_record IS NOT NULL AND old_record ? 'json_data')
);

-- Re-enable triggers
ALTER TABLE ccbc_public.record_version ENABLE TRIGGER ALL;

COMMIT;
